<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Unity WebGL Player | activity-test</title>
  <link rel="shortcut icon" href="TemplateData/favicon.ico">
  <link rel="stylesheet" href="TemplateData/style.css">
</head>

<body>
  <!-- Start Overlay -->
  <div id="start-overlay" style="
        position:fixed; top:0; left:0; width:100%; height:100%;
        display:flex; align-items:center; justify-content:center;
        background:rgba(0,0,0,0.8); z-index:1000;
      ">
    <button id="start-button" style="
          padding:1em 2em; font-size:1.5em; border:none;
          border-radius:.5em; background:#4CAF50; color:white;
        ">
      ▶ ゲームを開始
    </button>
  </div>

  <!-- Unity WebGL Container (hidden until start) -->
  <div id="unity-container" class="unity-desktop" style="display:none">
    <canvas id="unity-canvas" width="960" height="600" tabindex="-1"></canvas>
    <div id="unity-loading-bar">
      <div id="unity-logo"></div>
      <div id="unity-progress-bar-empty">
        <div id="unity-progress-bar-full"></div>
      </div>
    </div>
    <div id="unity-warning"></div>
    <div id="unity-footer">
      <div id="unity-webgl-logo"></div>
      <div id="unity-fullscreen-button"></div>
      <div id="unity-build-title">activity-test</div>
    </div>
  </div>

  <!-- Unity warning banner handler -->
  <script>
    function unityShowBanner(msg, type) {
      const banner = document.querySelector('#unity-warning');
      function update() {
        banner.style.display = banner.children.length ? 'block' : 'none';
      }
      const div = document.createElement('div');
      div.innerHTML = msg;
      banner.appendChild(div);
      if (type === 'error') div.style = 'background:red;padding:10px;';
      else if (type === 'warning') div.style = 'background:yellow;padding:10px;';
      setTimeout(() => { banner.removeChild(div); update(); }, type === 'error' ? 0 : 5000);
      update();
    }
  </script>

  <!-- Start Button Logic: resume audio & load Unity -->
  <script>
    document.getElementById('start-button').addEventListener('click', () => {
      // Resume AudioContext on user gesture
      const AudioCtx = window.AudioContext || window.webkitAudioContext;
      if (AudioCtx) {
        const ctx = new AudioCtx();
        if (ctx.state === 'suspended') ctx.resume();
      }

      // Hide overlay, show Unity container
      document.getElementById('start-overlay').style.display = 'none';
      document.getElementById('unity-container').style.display = 'block';

      // Load Unity loader
      const script = document.createElement('script');
      script.src = 'Build/Build.loader.js';
      script.onload = () => {
        createUnityInstance(
          document.getElementById('unity-canvas'),
          {
            dataUrl:         'Build/Build.data',
            frameworkUrl:    'Build/Build.framework.js',
            codeUrl:         'Build/Build.wasm',
            streamingAssetsUrl: 'StreamingAssets',
            companyName:     'DefaultCompany',
            productName:     'activity-test',
            productVersion:  '0.1',
            showBanner:      unityShowBanner
          },
          (progress) => {
            document.getElementById('unity-progress-bar-full').style.width = (progress*100) + '%';
          }
        ).then((unityInstance) => {
          // Hide loading bar, setup fullscreen
          document.getElementById('unity-loading-bar').style.display = 'none';
          document.getElementById('unity-fullscreen-button').onclick = () => unityInstance.SetFullscreen(1);
        }).catch((err) => console.error(err));
      };
      document.body.appendChild(script);
    });
  </script>
</body>
</html>
